<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Form Order</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr" crossorigin="anonymous">
  </head>
  <style>
#results { max-height:300px; overflow-y:auto; border:1px solid #ddd; }
.result-item { padding:8px; cursor:pointer; border-bottom:1px solid #eee; }
.result-item:hover { background:#f8f9fa; }
</style>
  <body>
  <div class="container-fluid">
  <h4 class="fw-bold text-center my-4">Form Pemesanan</h4>
  <form id="orderForm">
  <div class="mb-3 px-3">
    <div class="mb-3">
    <label class="form-label">Pilihan Paket</label>
    <select name="paket" class="form-select" required>
      <option value="" disabled selected>-- Pilih Paket Obat --</option>
      <option>1 Botol Xerdiove Nakara</option>
      <option>2 Botol Xerdiove Nakara</option>
      <option>3 Botol Xerdiove Nakara</option>
      <option>4 Botol Xerdiove Nakara</option>
      <option>5 Botol Xerdiove Nakara</option>
      <option>6 Botol Xerdiove Nakara</option>
    </select>
  </div>
  <div class="mb-3">
    <label class="form-label">Nama</label>
    <input type="text" name="nama" class="form-control" placeholder="Ketik nama lengkap" required>
  </div>

  <div class="mb-3">
    <label class="form-label">Nomor WhatsApp</label>
    <input type="number" name="wa" class="form-control" placeholder="Ketik nomor whatsapp" minlength="10" required>
  </div>

  <div class="mb-3">
    <label class="form-label">Alamat</label>
    <input type="text" id="alamatutama" name="alamatutama" class="form-control" placeholder="Ketik nama kecamatan...">
    <div id="results"></div>
  </div>

  <div class="mb-3">
    <label class="form-label">Detail Alamat</label>
    <textarea name="alamat" class="form-control" placeholder="Ketik Jl / No.Rumah / Patokan" required></textarea>
  </div>

  <div class="mb-3">
    <label class="form-label">Metode Pembayaran</label>
    <div class="form-check">
      <input class="form-check-input" type="radio" name="metodePembayaran" id="cod" value="COD" required>
      <label class="form-check-label" for="cod">
        COD
      </label>
    </div>
    <div class="form-check">
      <input class="form-check-input" type="radio" name="metodePembayaran" id="transfer" value="Transfer" required>
      <label class="form-check-label" for="transfer">
        Transfer
      </label>
    </div>
  </div>

  <div class="text-center">
    <button type="submit" class="btn btn-primary" style=" padding-inline: 55px;">Kirim</button>
  </div>
  
</form>

<div id="statusMsg" class="mt-3"></div>

   </div>

  <p id="status"></p>

<script>
const GAS_WEB_APP_URL = "https://script.google.com/macros/s/AKfycbzGuxuqEVW3QLnaK0IEqTgF3tepHyaY9OqlQv1nl7ijAmNOREeV9HrMB6upIPWLeHiA/exec";
let timeout;

document.getElementById('alamatutama').addEventListener('input', function() {
  const keyword = this.value.trim();
  const resultsDiv = document.getElementById('results');
  clearTimeout(timeout);

  if (keyword.length < 3) {
    resultsDiv.innerHTML = "<div class='p-2 text-muted'>Ketik minimal 3 huruf...</div>";
    return;
  }

  resultsDiv.innerHTML = "<div class='p-2 text-primary'>Mencari...</div>";

  timeout = setTimeout(async () => {
    try {
      const res = await fetch(`${GAS_WEB_APP_URL}?keyword=${encodeURIComponent(keyword)}`);
      const data = await res.json();

      const resultsArray = Array.isArray(data.result) ? data.result : [];

      if (resultsArray.length === 0) {
        resultsDiv.innerHTML = "<div class='p-2 text-danger'>Tidak ada hasil ditemukan</div>";
        return;
      }

      resultsDiv.innerHTML = resultsArray.slice(0,50).map(item => `
        <div class="result-item" 
             data-kel="${item.desakel}" 
             data-kec="${item.kecamatan}" 
             data-kab="${item.kabkota}" 
             data-prov="${item.provinsi}">
          <strong>${item.desakel}</strong><br>
          <small>${item.kecamatan}, ${item.kabkota}, ${item.provinsi}</small>
        </div>
      `).join('');

      document.querySelectorAll('.result-item').forEach(el => {
        el.addEventListener('click', () => {
          // Format satu baris: kelurahan, kecamatan, kabupaten, provinsi
          const fullAddress = `${el.dataset.kel}, ${el.dataset.kec}, ${el.dataset.kab}, ${el.dataset.prov}`;
          document.getElementById('alamatutama').value = fullAddress;

          resultsDiv.innerHTML = ""; // hilangkan hasil pencarian
        });
      });

    } catch(err) {
      resultsDiv.innerHTML = "<div class='p-2 text-danger'>Gagal mengambil data</div>";
      console.error(err);
    }
  }, 400); // debounce 400ms
});
</script>

  <script>
    const scriptURL = 'https://script.google.com/macros/s/AKfycbzVsoly_ogNtebfn1A5CqPy1XVG69TEqg_PUQk6Rb8oV7daLEsbtzEftD-mVfhj19cnQw/exec';
    const form = document.getElementById('orderForm');
    const status = document.getElementById('status');

    form.addEventListener('submit', e => {
      e.preventDefault();
      status.textContent = "Mengirim...";

      fetch(scriptURL, { method: 'POST', body: new FormData(form) })
        .then(response => {
          status.textContent = "Data berhasil dikirim!";
                
      // Ambil data user dari form
const nama = form.nama.value || '';
const paketobat = form.paket.value || '';
      
      // Reset form
      form.reset();

      // 1. Kirim ke WhatsApp penjual
      const waPenjual = '6285185044075'; // format +62 tanpa 0
      const pesan = `Halo Dok, Saya sudah melakukan pemesanan *${paketobat}* atas nama *${nama}* Mohon segera di proses ya. Terima kasih`;
      const waLink = `https://wa.me/${waPenjual}?text=${encodeURIComponent(pesan)}`;

      // Buka WA di tab baru
      window.open(waLink, '_blank');
        })
        .catch(error => {
          status.textContent = "Gagal mengirim data.";
          console.error('Error!', error.message);
        });
    });
  </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js" integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q" crossorigin="anonymous"></script>
  </body>
</html>
